---
title: "Final Project"
author: "Harrison Magee, Michael Feron, Blake Waechter"
date: "November 13, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Preliminary Data Gathering
Below, we gather and process our data
```{r prelim, echo = TRUE}
bodyfat.dat = read.table("http://inside.mines.edu/~wnavidi/math424/project/bodyfat.dat", 
                         header = TRUE)
bodyfatDF = as.data.frame(bodyfat.dat)

min(bodyfatDF$Bodyfat)
bodyfatDF <- bodyfatDF[-c(which.min(bodyfatDF$Bodyfat)),]
min(bodyfatDF$Bodyfat)
max(bodyfatDF$Bodyfat)

min(bodyfatDF$Age)
max(bodyfatDF$Age)

min(bodyfatDF$Weight)
max(bodyfatDF$Weight)

min(bodyfatDF$Height)
bodyfatDF <- bodyfatDF[-c(which.min(bodyfatDF$Height)),]
min(bodyfatDF$Height)
max(bodyfatDF$Height)

min(bodyfatDF$BMI)
max(bodyfatDF$BMI)

min(bodyfatDF$Abdomen)
max(bodyfatDF$Abdomen)

min(bodyfatDF$Ankle)
max(bodyfatDF$Ankle)

min(bodyfatDF$Biceps)
max(bodyfatDF$Biceps)

min(bodyfatDF$Chest)
max(bodyfatDF$Chest)

min(bodyfatDF$Forearm)
max(bodyfatDF$Forearm)

min(bodyfatDF$Hip)
max(bodyfatDF$Hip)

min(bodyfatDF$Knee)
max(bodyfatDF$Knee)

min(bodyfatDF$Neck)
max(bodyfatDF$Neck)

min(bodyfatDF$Thigh)
max(bodyfatDF$Thigh)

min(bodyfatDF$Wrist)
max(bodyfatDF$Wrist)

Bodyfat = bodyfatDF$Bodyfat
Age = bodyfatDF$Age
Weight = bodyfatDF$Weight
Height = bodyfatDF$Height
BMI = bodyfatDF$BMI
Abdomen = bodyfatDF$Abdomen
Ankle = bodyfatDF$Ankle
Biceps = bodyfatDF$Biceps
Chest = bodyfatDF$Chest
Forearm = bodyfatDF$Forearm
Hip = bodyfatDF$Hip
Knee = bodyfatDF$Knee
Neck = bodyfatDF$Neck
Thigh = bodyfatDF$Thigh
Wrist = bodyfatDF$Wrist
```

Boxplots for the data to help identify influential points later on
```{r box, echo = TRUE}
boxplot(Bodyfat, main="Bodyfat")
boxplot(Age, main="Age")
boxplot(Weight, main="Weight")
boxplot(Height, main="Height")
boxplot(BMI, main="BMI")
boxplot(Abdomen, main="Abdomen")
boxplot(Ankle, main="Ankle")
boxplot(Biceps, main="Biceps")
boxplot(Chest, main="Chest")
boxplot(Forearm, main="Forearm")
boxplot(Hip, main="Hip")
boxplot(Knee, main="Knee")
boxplot(Neck, main="Neck")
boxplot(Thigh, main="Thigh")
boxplot(Wrist, main="Wrist")
```




## Fit the first linear model
Below we fit a simple linear model
Figure 1
```{r lm_all, echo = TRUE}
all.lm = lm(Bodyfat ~ Age + Weight + Height + BMI + Neck + Chest + Abdomen + Hip + 
              Thigh + Knee + Ankle + Biceps + Forearm + Wrist)
all.sum = summary(all.lm)
all.sum
```
Scater plots for high p-val variables
```{r p-testing, echo=TRUE}
plot(Age, Bodyfat, main = "Bodyfat Vs. Age")
plot(Height, Bodyfat, main = "Bodyfat Vs. Height")
plot(BMI, Bodyfat, main = "Bodyfat Vs. BMI")
plot(Chest, Bodyfat, main = "Bodyfat Vs. Chest")
plot(Knee, Bodyfat, main = "Bodyfat Vs. Knee")
plot(Ankle, Bodyfat, main = "Bodyfat Vs. Ankle")
plot(Biceps, Bodyfat, main = "Bodyfat Vs. Biceps")
```

Fit a linear model without height
Figure 2
```{r model_without_height, echo = TRUE}
new1.lm = lm(Bodyfat ~ Age + Weight + BMI + Neck + Chest + Abdomen + Hip + Thigh
             + Knee + Ankle + Biceps + Forearm + Wrist)
new1.sum = summary(new1.lm)
new1.sum
```

Calculate the $F$-statistic for the reduced model
```{r f_new1, echo=TRUE}
anova(new1.lm, all.lm)
```
New model without ankle
```{r model_without_ankle, echo = TRUE}
new2.lm = lm(Bodyfat ~ Age + Weight + BMI + Neck + Chest + Abdomen + Hip + Thigh
             + Knee + Biceps + Forearm + Wrist)
new2.sum = summary(new2.lm)
new2.sum
```
Calculate $F$-statistic for removing ankle
```{r f_new2, echo=TRUE}
anova(new2.lm, new1.lm)
```

New linear model dropping Chest, Knee, Biceps
```{r model_without_Chest_Knee_Biceps, echo = TRUE}
new3.lm = lm(Bodyfat ~ Age + Weight + BMI + Neck + Abdomen + Hip + Thigh + 
               Forearm + Wrist)
new3.sum = summary(new3.lm)
new3.sum
```

Calculate $F$-statistic for dropping Chest, Knee, Biceps
Figure 3
```{r f_new3, echo=TRUE}
anova(new3.lm, new1.lm)
```


```{r BMI_colinearity, echo = TRUE}
plot(BMI, Weight, main = "BMI vs Weight")
plot(BMI, Height)
plot(BMI, 1/(Height*Height))
```

New model dropping BMI
Figure 4
```{r model_without_BMI, echo = TRUE}
new4.lm = lm(Bodyfat ~ Age + Weight + Neck + Abdomen + Hip + Thigh + Forearm + 
               Wrist)
new4.sum = summary(new4.lm)
new4.sum
```

Calculate $F$-statistic for dropping BMI
```{r f_new4, echo=TRUE}
anova(new4.lm, new3.lm)
```

Running best subsets on full linear model
Figure 5
```{r best_subsets_full, echo = TRUE}
library("leaps")
bestall = regsubsets(Bodyfat ~ Age + Weight + Height + BMI + Neck + Chest + 
                       Abdomen + Hip + Thigh + Knee + Ankle + Biceps + Forearm + 
                       Wrist, data = bodyfatDF[,2:15], nbest = 1, nvmax=15)
bestall.sum = summary(bestall)
bestall.sum$which
cbind(bestall.sum$rsq, bestall.sum$adjr2, bestall.sum$cp)
```


```{r best_model, echo=TRUE}
anova(new4.lm, all.lm)
```

Calculating the linear models for all interactions of Body Measurements
```{r interactions, echo=TRUE}
NeckAbdomen = Neck*Abdomen
NeckHip = Neck*Hip
NeckThigh = Neck*Thigh
NeckForearm = Neck*Forearm
NeckWrist = Neck*Wrist
AbdomenHip = Abdomen*Hip
AbdomenThigh = Abdomen*Thigh
AbdomenForearm = Abdomen*Forearm
AbdomenWrist = Abdomen*Wrist
HipThigh = Hip*Thigh
HipForearm = Hip*Forearm
HipWrist = Hip*Wrist
ThighForearm = Thigh*Forearm
ThighWrist = Thigh*Wrist
ForearmWrist = Forearm*Wrist
Neck2 = Neck^2
Abdomen2 = Abdomen^2
Hip2 = Hip^2
Thigh2 = Thigh^2
Forearm2 = Forearm^2
Wrist2 = Wrist^2
logNeck = log(Neck)
logAbdomen = log(Abdomen)
logHip = log(Hip)
logThigh = log(Thigh)
logForearm = log(Forearm)
logWrist = log(Wrist)

interactions.lm = lm(Bodyfat ~ Age + Weight + Neck + Abdomen + Hip + Thigh + 
                       Forearm + Wrist + NeckAbdomen + NeckHip + NeckThigh + 
                       NeckForearm + NeckWrist + AbdomenHip + AbdomenThigh + 
                       AbdomenForearm + AbdomenWrist + HipThigh + HipForearm + 
                       HipWrist + ThighForearm + ThighWrist + ForearmWrist + 
                       Neck2 + Abdomen2 + Hip2 + Thigh2 + Forearm2 + Wrist2 + 
                       logNeck + logAbdomen + logHip + logThigh + logForearm + 
                       logWrist)

interactions.sum = summary(interactions.lm)
interactions.sum
```

Best Subsets on the interactions
```{r best_subsets_interactions, echo = TRUE}
interactDF = as.data.frame(cbind(Age, Weight, Neck, Abdomen, Hip, Thigh, Forearm, 
                                 Wrist, NeckAbdomen, NeckHip, NeckThigh, NeckForearm, 
                                 NeckWrist, AbdomenHip, AbdomenThigh, AbdomenForearm, 
                                 AbdomenWrist, HipThigh, HipForearm, HipWrist, 
                                 ThighForearm, ThighWrist, ForearmWrist, Neck2, 
                                 Abdomen2, Hip2, Thigh2, Forearm2, Wrist2, logNeck, 
                                 logAbdomen, logHip, logThigh, logForearm, logWrist))


interactbest = regsubsets(Bodyfat ~ Age + Weight + Neck + Abdomen + Hip + Thigh + 
                            Forearm + Wrist + NeckAbdomen + NeckHip + NeckThigh + 
                            NeckForearm + NeckWrist + AbdomenHip + AbdomenThigh + 
                            AbdomenForearm + AbdomenWrist + HipThigh + HipForearm + 
                            HipWrist + ThighForearm + ThighWrist + ForearmWrist + 
                            Neck2 + Abdomen2 + Hip2 + Thigh2 + Forearm2 + Wrist2 + 
                            logNeck + logAbdomen + logHip + logThigh + logForearm + 
                            logWrist, data = interactDF, nbest = 1, nvmax=35)
interactbest.sum = summary(interactbest)
interactbest.sum$which
cbind(bestall.sum$rsq, bestall.sum$adjr2, bestall.sum$cp)
maxradj = which.max(bestall.sum$adjr2)
mincp = which.min(bestall.sum$cp)
maxradj
mincp
```

Fit linear model for the best subsets
```{r best_subsets, echo=TRUE}
subsets.lm = lm(Bodyfat ~ Age + Weight + Thigh + Neck + Abdomen + Forearm + 
                  Wrist + NeckAbdomen + NeckThigh + ForearmWrist + Abdomen2 + 
                  Forearm2)
subsets.sum = summary(subsets.lm)
subsets.sum
```

Stepwise Regression on all regressions
```{r stepwise_interactions, echo=TRUE}
model0 = lm(Bodyfat ~ 1, data = interactDF)
model1 = lm(Bodyfat ~ ., data = interactDF)
step(model0, scope = list(lower=model0, upper=model1), direction="both")
```

We fit the linear model suggested by stepwise regression
```{r stepwise, echo=TRUE}
stepwise.lm = lm(Bodyfat ~ logAbdomen + HipWrist + Neck + ThighForearm + 
                   Age + Abdomen + Hip + Wrist + Thigh + Forearm)
stepwise.sum = summary(stepwise.lm)
stepwise.sum
```

Compare the linear models
```{r compare, echo = FALSE, results='show'}
new4.sum
subsets.sum
stepwise.sum
```

Test our model with training and testing data
```{r train_test, echo=TRUE}
newDF_x = as.data.frame(cbind(Age, Weight, Neck, Abdomen, Hip, Thigh, 
                              Forearm, Wrist))
train = sample(1:252, 200)
test = (-train)
trainX = newDF_x[train,]
trainY = Bodyfat[train]
testX = newDF_x[test,]
testY = Bodyfat[test]

train.lm = lm(trainY ~ Age + Weight + Neck + Abdomen + Hip + Thigh + Forearm + 
                Wrist, data=trainX)
train.sum = summary(train.lm)
train.sum

test.lm = lm(testY ~ Age + Weight + Neck + Abdomen + Hip + Thigh + Forearm + 
               Wrist, data=testX)
test.sum = summary(test.lm)
test.sum
```

Plotting Residuals for the model
```{r residuals, echo=TRUE}
plot(new4.lm)
```